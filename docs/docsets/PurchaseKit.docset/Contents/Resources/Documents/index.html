<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PurchaseKit  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="PurchaseKit  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">PurchaseKit Docs</a> (9% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">PurchaseKit Reference</a>
        <img id="carat" src="img/carat.png" />
        PurchaseKit  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/PKCompleteTransactionsController.html">PKCompleteTransactionsController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKInAppProductQueryRequest.html">PKInAppProductQueryRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKInAppReceiptRefreshRequest.html">PKInAppReceiptRefreshRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKInAppReceiptRefreshRequest/PKResultType.html">– PKResultType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKInAppReceiptVerificator.html">PKInAppReceiptVerificator</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKPaymentQueueController.html">PKPaymentQueueController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKPaymentsController.html">PKPaymentsController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKProductsInfoController.html">PKProductsInfoController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PKRestorePurchasesController.html">PKRestorePurchasesController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PurchaseKit.html">PurchaseKit</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/PKPurchaseResult.html">PKPurchaseResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKReceiptError.html">PKReceiptError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKReceiptExitCode.html">PKReceiptExitCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKReceiptExitCode.html">PKReceiptExitCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKReceiptInfoField.html">PKReceiptInfoField</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKReceiptInfoField/InApp.html">– InApp</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKReceiptStatus.html">PKReceiptStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKRefreshReceiptResult.html">PKRefreshReceiptResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKSubscriptionType.html">PKSubscriptionType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKTransactionResult.html">PKTransactionResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKVerifyPurchaseResult.html">PKVerifyPurchaseResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKVerifyReceiptResult.html">PKVerifyReceiptResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PKVerifySubscriptionResult.html">PKVerifySubscriptionResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Date.html">Date</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SKPaymentTransaction.html">SKPaymentTransaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SKPaymentTransactionState.html">SKPaymentTransactionState</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SKProduct.html">SKProduct</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/PKPaymentQueue.html">PKPaymentQueue</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PKPaymentTransaction.html">PKPaymentTransaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PKReceiptValidator.html">PKReceiptValidator</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PKTransactionController.html">PKTransactionController</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/PKAppleReceiptValidator.html">PKAppleReceiptValidator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKAppleReceiptValidator/PKVerifyReceiptURLType.html">– PKVerifyReceiptURLType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKCompleteTransactions.html">PKCompleteTransactions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKPayment.html">PKPayment</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKPurchase.html">PKPurchase</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKPurchaseDetails.html">PKPurchaseDetails</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKReceiptItem.html">PKReceiptItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKRestorePurchases.html">PKRestorePurchases</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKRestoreResults.html">PKRestoreResults</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PKRetrieveResults.html">PKRetrieveResults</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p align="center">
  <img src="https://ooo.0o0.ooo/2017/07/22/5972d2dfdbe6e.png" alt="PurchaseKit">
  <br/><br/>
  <a href="https://cocoapods.org/pods/PurchaseKit">
  <img alt="Version" src="https://img.shields.io/badge/version-1.0.0-brightgreen.svg">
  <img alt="Author" src="https://img.shields.io/badge/author-Meniny-blue.svg">
  <img alt="Build Passing" src="https://img.shields.io/badge/build-passing-brightgreen.svg">
  <img alt="Swift" src="https://img.shields.io/badge/swift-3.0%2B-orange.svg">
  <br/>
  <img alt="Platforms" src="https://img.shields.io/badge/platform-macOS%20%7C%20iOS%20%7C%20tvOS-lightgrey.svg">
  <img alt="MIT" src="https://img.shields.io/badge/license-MIT-blue.svg">
  <br/>
  <img alt="Cocoapods" src="https://img.shields.io/badge/cocoapods-compatible-brightgreen.svg">
  <img alt="Carthage" src="https://img.shields.io/badge/carthage-working%20on-red.svg">
  <img alt="SPM" src="https://img.shields.io/badge/swift%20package%20manager-working%20on-red.svg">
  </a>
</p>

<hr>
<h1 id='introduction' class='heading'>Introduction</h1>
<h2 id='what-39-s-this' class='heading'>What&rsquo;s this?</h2>

<p><code>PurchaseKit</code> is an In-App Purchase Framework written in Swift.</p>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 8.0+</li>
<li>macOS 10.10+</li>
<li>tvOS 9.0+</li>
<li>Xcode 8+ with Swift 3+</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h4 id='cocoapods' class='heading'>CocoaPods</h4>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'PurchaseKit'</span>
</code></pre>
<h2 id='contribution' class='heading'>Contribution</h2>

<p>You are welcome to fork and submit pull requests.</p>
<h2 id='license' class='heading'>License</h2>

<p><code>PurchaseKit</code> is open-sourced software, licensed under the <code>MIT</code> license.</p>
<h1 id='usage' class='heading'>Usage</h1>
<h3 id='complete-transactions' class='heading'>Complete Transactions</h3>

<p>Apple recommends to register a transaction observer <a href="https://developer.apple.com/library/ios/technotes/tn2387/_index.html">as soon as the app starts</a>:</p>

<blockquote>
<p>Adding your app&rsquo;s observer at launch ensures that it will persist during all launches of your app, thus allowing your app to receive all the payment queue notifications.</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSObject</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">completeTransactions</span><span class="p">(</span><span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">purchases</span> <span class="k">in</span>

        <span class="k">for</span> <span class="n">purchase</span> <span class="k">in</span> <span class="n">purchases</span> <span class="p">{</span>

            <span class="k">if</span> <span class="n">purchase</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">transactionState</span> <span class="o">==</span> <span class="o">.</span><span class="n">purchased</span> <span class="o">||</span> <span class="n">purchase</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">transactionState</span> <span class="o">==</span> <span class="o">.</span><span class="n">restored</span> <span class="p">{</span>

               <span class="k">if</span> <span class="n">purchase</span><span class="o">.</span><span class="n">needsFinishTransaction</span> <span class="p">{</span>
                   <span class="c1">// Deliver content from server, then:</span>
                   <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">finishTransaction</span><span class="p">(</span><span class="n">purchase</span><span class="o">.</span><span class="n">transaction</span><span class="p">)</span>
               <span class="p">}</span>
               <span class="nf">print</span><span class="p">(</span><span class="s">"purchased: </span><span class="se">\(</span><span class="n">purchase</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<h2 id='purchases' class='heading'>Purchases</h2>
<h3 id='retrieve-products-info' class='heading'>Retrieve products info</h3>
<pre class="highlight swift"><code><span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">retrieveProductsInfo</span><span class="p">([</span><span class="s">"cn.meniny.PurchaseKit.Purchase1"</span><span class="p">])</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">product</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">retrievedProducts</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">priceString</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">localizedPrice</span><span class="o">!</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Product: </span><span class="se">\(</span><span class="n">product</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">, price: </span><span class="se">\(</span><span class="n">priceString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">invalidProductId</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">invalidProductIDs</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">alertWithTitle</span><span class="p">(</span><span class="s">"Could not retrieve product info"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"Invalid product identifier: </span><span class="se">\(</span><span class="n">invalidProductId</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
         <span class="nf">print</span><span class="p">(</span><span class="s">"Error: </span><span class="se">\(</span><span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='purchase-a-product' class='heading'>Purchase a product</h3>
<pre class="highlight swift"><code><span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">purchaseProduct</span><span class="p">(</span><span class="s">"cn.meniny.PurchaseKit.Purchase1"</span><span class="p">,</span> <span class="nv">quantity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">purchase</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Purchase Success: </span><span class="se">\(</span><span class="n">purchase</span><span class="o">.</span><span class="n">productId</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="k">switch</span> <span class="n">error</span><span class="o">.</span><span class="n">code</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">unknown</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Unknown error. Please contact support"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">clientInvalid</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Not allowed to make the payment"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">paymentCancelled</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">paymentInvalid</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The purchase identifier was invalid"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">paymentNotAllowed</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The device is not allowed to make the payment"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">storeProductNotAvailable</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The product is not available in the current storefront"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">cloudServicePermissionDenied</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Access to cloud service information is not allowed"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">cloudServiceNetworkConnectionFailed</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Could not connect to the network"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">cloudServiceRevoked</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"User has revoked permission to use this cloud service"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">purchaseProduct</span><span class="p">(</span><span class="s">"cn.meniny.PurchaseKit.Purchase1"</span><span class="p">,</span> <span class="nv">quantity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">product</span><span class="p">):</span>
        <span class="c1">// fetch content from your server, then:</span>
        <span class="k">if</span> <span class="n">product</span><span class="o">.</span><span class="n">needsFinishTransaction</span> <span class="p">{</span>
            <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">finishTransaction</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">transaction</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Purchase Success: </span><span class="se">\(</span><span class="n">product</span><span class="o">.</span><span class="n">productId</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="k">switch</span> <span class="n">error</span><span class="o">.</span><span class="n">code</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">unknown</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Unknown error. Please contact support"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">clientInvalid</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Not allowed to make the payment"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">paymentCancelled</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">paymentInvalid</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The purchase identifier was invalid"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">paymentNotAllowed</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The device is not allowed to make the payment"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">storeProductNotAvailable</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The product is not available in the current storefront"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">cloudServicePermissionDenied</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Access to cloud service information is not allowed"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">cloudServiceNetworkConnectionFailed</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Could not connect to the network"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">cloudServiceRevoked</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"User has revoked permission to use this cloud service"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">retrieveProductsInfo</span><span class="p">([</span><span class="s">"cn.meniny.PurchaseKit.Purchase1"</span><span class="p">])</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">product</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">retrievedProducts</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
        <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">purchaseProduct</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="nv">quantity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
            <span class="c1">// handle result (same as above)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='restore-previous-purchases' class='heading'>Restore previous purchases</h3>
<pre class="highlight swift"><code><span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">restorePurchases</span><span class="p">(</span><span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">results</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">restoreFailedPurchases</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Restore Failed: </span><span class="se">\(</span><span class="n">results</span><span class="o">.</span><span class="n">restoreFailedPurchases</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">restoredPurchases</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Restore Success: </span><span class="se">\(</span><span class="n">results</span><span class="o">.</span><span class="n">restoredPurchases</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Nothing to Restore"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">restorePurchases</span><span class="p">(</span><span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="n">results</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">restoreFailedPurchases</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Restore Failed: </span><span class="se">\(</span><span class="n">results</span><span class="o">.</span><span class="n">restoreFailedPurchases</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">restoredPurchases</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">purchase</span> <span class="k">in</span> <span class="n">results</span><span class="o">.</span><span class="n">restoredPurchases</span> <span class="p">{</span>
            <span class="c1">// fetch content from your server, then:</span>
            <span class="k">if</span> <span class="n">purchase</span><span class="o">.</span><span class="n">needsFinishTransaction</span> <span class="p">{</span>
                <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">finishTransaction</span><span class="p">(</span><span class="n">purchase</span><span class="o">.</span><span class="n">transaction</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Restore Success: </span><span class="se">\(</span><span class="n">results</span><span class="o">.</span><span class="n">restoredPurchases</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Nothing to Restore"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='receipt-verification' class='heading'>Receipt verification</h2>
<h3 id='retrieve-local-receipt' class='heading'>Retrieve local receipt</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">receiptData</span> <span class="o">=</span> <span class="kt">PurchaseKit</span><span class="o">.</span><span class="n">localReceiptData</span>
<span class="k">let</span> <span class="nv">receiptString</span> <span class="o">=</span> <span class="n">receiptData</span><span class="o">.</span><span class="nf">base64EncodedString</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
<span class="c1">// do your receipt validation here</span>
</code></pre>
<h3 id='verify-receipt' class='heading'>Verify Receipt</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">appleValidator</span> <span class="o">=</span> <span class="kt">PKAppleReceiptValidator</span><span class="p">(</span><span class="nv">service</span><span class="p">:</span> <span class="o">.</span><span class="n">production</span><span class="p">)</span>
<span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifyReceipt</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">appleValidator</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"your-shared-secret"</span><span class="p">,</span> <span class="nv">forceRefresh</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">receipt</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Verify receipt Success: </span><span class="se">\(</span><span class="n">receipt</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Verify receipt Failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='verifying-purchases-and-subscriptions' class='heading'>Verifying purchases and subscriptions</h2>
<h3 id='verify-purchase' class='heading'>Verify Purchase</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">appleValidator</span> <span class="o">=</span> <span class="kt">PKAppleReceiptValidator</span><span class="p">(</span><span class="nv">service</span><span class="p">:</span> <span class="o">.</span><span class="n">production</span><span class="p">)</span>
<span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifyReceipt</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">appleValidator</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"your-shared-secret"</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">receipt</span><span class="p">):</span>
        <span class="c1">// Verify the purchase of Consumable or NonConsumable</span>
        <span class="k">let</span> <span class="nv">purchaseResult</span> <span class="o">=</span> <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifyPurchase</span><span class="p">(</span>
            <span class="nv">productId</span><span class="p">:</span> <span class="s">"cn.meniny.PurchaseKit.Purchase1"</span><span class="p">,</span>
            <span class="nv">inReceipt</span><span class="p">:</span> <span class="n">receipt</span><span class="p">)</span>

        <span class="k">switch</span> <span class="n">purchaseResult</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">purchased</span><span class="p">(</span><span class="k">let</span> <span class="nv">receiptItem</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Product is purchased: </span><span class="se">\(</span><span class="n">receiptItem</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notPurchased</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"The user has never purchased this product"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Receipt verification failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='verify-subscription' class='heading'>Verify Subscription</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">appleValidator</span> <span class="o">=</span> <span class="kt">PKAppleReceiptValidator</span><span class="p">(</span><span class="nv">service</span><span class="p">:</span> <span class="o">.</span><span class="n">production</span><span class="p">)</span>
<span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifyReceipt</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">appleValidator</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"your-shared-secret"</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">receipt</span><span class="p">):</span>
        <span class="c1">// Verify the purchase of a Subscription</span>
        <span class="k">let</span> <span class="nv">purchaseResult</span> <span class="o">=</span> <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifySubscription</span><span class="p">(</span>
            <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">autoRenewable</span><span class="p">,</span> <span class="c1">// or .nonRenewing (see below)</span>
            <span class="nv">productId</span><span class="p">:</span> <span class="s">"cn.meniny.PurchaseKit.Subscription"</span><span class="p">,</span>
            <span class="nv">inReceipt</span><span class="p">:</span> <span class="n">receipt</span><span class="p">)</span>

        <span class="k">switch</span> <span class="n">purchaseResult</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">purchased</span><span class="p">(</span><span class="k">let</span> <span class="nv">expiryDate</span><span class="p">,</span> <span class="k">let</span> <span class="nv">receiptItems</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Product is valid until </span><span class="se">\(</span><span class="n">expiryDate</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">expired</span><span class="p">(</span><span class="k">let</span> <span class="nv">expiryDate</span><span class="p">,</span> <span class="k">let</span> <span class="nv">receiptItems</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Product is expired since </span><span class="se">\(</span><span class="n">expiryDate</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notPurchased</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"The user has never purchased this product"</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">case</span> <span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Receipt verification failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h4 id='auto-renewable' class='heading'>Auto-Renewable</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">purchaseResult</span> <span class="o">=</span> <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifySubscription</span><span class="p">(</span>
            <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">autoRenewable</span><span class="p">,</span>
            <span class="nv">productId</span><span class="p">:</span> <span class="s">"cn.meniny.PurchaseKit.Subscription"</span><span class="p">,</span>
            <span class="nv">inReceipt</span><span class="p">:</span> <span class="n">receipt</span><span class="p">)</span>
</code></pre>
<h4 id='non-renewing' class='heading'>Non-Renewing</h4>
<pre class="highlight swift"><code><span class="c1">// validDuration: time interval in seconds</span>
<span class="k">let</span> <span class="nv">purchaseResult</span> <span class="o">=</span> <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifySubscription</span><span class="p">(</span>
            <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="nf">nonRenewing</span><span class="p">(</span><span class="nv">validDuration</span><span class="p">:</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span>
            <span class="nv">productId</span><span class="p">:</span> <span class="s">"cn.meniny.PurchaseKit.Subscription"</span><span class="p">,</span>
            <span class="nv">inReceipt</span><span class="p">:</span> <span class="n">receipt</span><span class="p">)</span>
</code></pre>
<h4 id='purchasing-and-verifying-a-subscription' class='heading'>Purchasing and verifying a subscription</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">productId</span> <span class="o">=</span> <span class="s">"your-product-id"</span>
<span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">purchaseProduct</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>

    <span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">purchase</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
        <span class="c1">// Deliver content from server, then:</span>
        <span class="k">if</span> <span class="n">purchase</span><span class="o">.</span><span class="n">needsFinishTransaction</span> <span class="p">{</span>
            <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">finishTransaction</span><span class="p">(</span><span class="n">purchase</span><span class="o">.</span><span class="n">transaction</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">appleValidator</span> <span class="o">=</span> <span class="kt">PKAppleReceiptValidator</span><span class="p">(</span><span class="nv">service</span><span class="p">:</span> <span class="o">.</span><span class="n">production</span><span class="p">)</span>
        <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifyReceipt</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">appleValidator</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"your-shared-secret"</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>

            <span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">receipt</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">purchaseResult</span> <span class="o">=</span> <span class="kt">PurchaseKit</span><span class="o">.</span><span class="nf">verifySubscription</span><span class="p">(</span>
                    <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">autoRenewable</span><span class="p">,</span>
                    <span class="nv">productId</span><span class="p">:</span> <span class="n">productId</span><span class="p">,</span>
                    <span class="nv">inReceipt</span><span class="p">:</span> <span class="n">receipt</span><span class="p">)</span>

                <span class="k">switch</span> <span class="n">purchaseResult</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">purchased</span><span class="p">(</span><span class="k">let</span> <span class="nv">expiryDate</span><span class="p">,</span> <span class="k">let</span> <span class="nv">receiptItems</span><span class="p">):</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Product is valid until </span><span class="se">\(</span><span class="n">expiryDate</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">expired</span><span class="p">(</span><span class="k">let</span> <span class="nv">expiryDate</span><span class="p">,</span> <span class="k">let</span> <span class="nv">receiptItems</span><span class="p">):</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Product is expired since </span><span class="se">\(</span><span class="n">expiryDate</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">notPurchased</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"This product has never been purchased"</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// receipt verification error</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// purchase error</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2017 <a class="link" href="https://github.com/Meniny/PurchaseKit" target="_blank" rel="external">Meniny</a>. All rights reserved. (Last updated: 2017-07-22)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.8.2</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
